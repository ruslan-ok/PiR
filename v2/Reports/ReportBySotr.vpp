//------------------------------------------------------------------------------
//                                                      (c) Корпорация Галактика
// Заработная плата по отделу
// Контрольный отчет по сотруднику за период
//------------------------------------------------------------------------------

DataStream dsReportBySotr
(
  [FIO] mtPerson.FIO;

  table mtPeriod
  (
    [Year]             Year(mtPeriod.dBeg);            // Год
    [Month]            Month(mtPeriod.dBeg);           // Месяц
    [DaysPlan]         mtPeriod.PlanDays;              // Дней по плану
    [DaysFact]         mtPersPer.FactDays;             // Дней фактически
    [Salary]           CurApp_Salary;                  // Оклад
    [Salary_Check]     GetPrevSalary;                  // Оклад за прошлый месяц
    [DepBonus]         UE(R02);                        // Премия отдела
    [GovBonus]         UE(R03);                        // Премия Управления
    [PrBisnes]         UE(R04);                        // Проектный бизнес
    [OthBonus]         UE(R22);                        // Остальные начисления
                                                       // Начислено
    [Accrued]          UE(R07);
    [TaxDeductKol]     CurApp_TaxDed;                  // Льгота по подоходному налогу, количество
    [TaxDeductRB]      RB(R21);                        // Льгота по подоходному налогу, BYN
    [TaxDeductUE]      UE(R21);                        // Льгота по подоходному налогу, USD
    [IncomingRB]       RB(R08);                        // Вх. остаток, BYN
    [IncomingRB_Check] mtPersPer.PrevOut;              // Вх. остаток - контроль с распечаткой, BYN
    [IncomingUE]       UE(R08);                        // Вх. остаток, USD
    [ToIssue]          UE(R09);                        // К выдаче
    [PrepaymentRB]     RB(R10);                        // Аванс, BYN
    [PrepaymentEx]     Rate(R10);                      // Аванс, курс
    [PrepaymentUE]     UE(R10);                        // Аванс, USD
    [PaymBetwinRB]     RB(R11);                        // Отпуск, BYN
    [PaymBetwinEx]     if(RB(R11) = 0, 0, Rate(R11));  // Отпуск, курс
    [PaymBetwinUE]     UE(R11);                        // Отпуск, USD
    [SecPartRB]        RB(R13);                        // Выплата, BYN
    [SecPartEx]        if(RB(R13) = 0, 0, Rate(R13));  // Выплата, курс
    [SecPartUE]        UE(R13);                        // Выплата, USD
    [ThrdPartRB]       RB(R23);                        // Остальные выплаты, BYN
    [ThrdPartEx]       Rate(R23);                      // Остальные выплаты, курс
    [ThrdPartUE]       UE(R23);                        // Остальные выплаты, USD
    [TotalIssuedRB]    RB(R16);                        // Итого выдано, BYN
    [TotalIssuedUE]    UE(R16);                        // Итого выдано, USD
    [OutgoingRB]       RB(R15);                        // Исх. остаток, BYN в распечатке
    [OutgoingRB_Count] (UE(R09) - UE(R16)) * Rate(R13);              // Исх. остаток, BYN расчет
    [OutgoingRB_Delta] RB(R15) - ((UE(R09) - UE(R16)) * Rate(R13));    // Выдано лишнее, BYN
  );
)

HandleEvent table mtPeriod

cmOnProcess:
  GetCurAppoint(2);

End;

End;

private procedure ReportBySotr;
{
  if (mtStruct.Mode <> 2)
  {
    message('Не выбран сотрудник.');
    exit;
  }

  var CurPerson: byte;
  CurPerson := mtStruct.Person;
  PushPos(#mtPerson);
  PushPos(#mtStruct);
  PushPos(#mtPeriod);
  ResetBounds(#mtPerson);
  if (GetFirst mtPerson where (( CurPerson == mtPerson.Id )) = tsOk)
    RunFReport(dsReportBySotr, '', false);
  SetBounds(#mtPerson);
  PopPos(#mtPeriod);
  PopPos(#mtStruct);
  PopPos(#mtPerson);
  RereadRecord(#mtStruct);
}
