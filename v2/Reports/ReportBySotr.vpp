//------------------------------------------------------------------------------
//                                                      (c) Корпорация Галактика
// Заработная плата по отделу
// Контрольный отчет по сотруднику за период
//------------------------------------------------------------------------------

DataStream dsReportBySotr
(
  [FIO] mtStruct.Name;

  table mtPeriods
  (
    [Year]             Year(mtPeriods.dBeg);           // Год
    [Month]            Month(mtPeriods.dBeg);          // Месяц
    [DaysPlan]         mtPeriods.PlanDays;             // Дней по плану
    [DaysFact]         mtPersPer.FactDays;             // Дней фактически
    [Salary]           mtAppoint.Salary;                        // Оклад
    [Salary_Check]     GetPrevSalary;                  // Оклад за прошлый месяц
    [DepBonus]         UE(R02);                        // Премия отдела
    [GovBonus]         UE(R03);                        // Премия Управления
    [PrBisnes]         UE(R04);                        // Проектный бизнес
    [OthBonus]         UE(R05) + UE(R06);              // Другие премии
                                                       // Начислено
    [Accrued]          UE(R07);
    [TaxDeductKol]     mtAppoint.TaxDed;               // Льгота по подоходному налогу, количество
    [TaxDeductRB]      RB(R21);                        // Льгота по подоходному налогу, BYN
    [TaxDeductUE]      UE(R21);                        // Льгота по подоходному налогу, USD
    [IncomingRB]       RB(R08);                        // Вх. остаток, BYN
    [IncomingRB_Check] mtDebtOut.GetValue(mtStruct.Person, Sub_Months(mtPeriods.dBeg, 1), GetSumTitle(R15), cgNetBYN); // Вх. остаток - контроль с распечаткой, BYN
    [IncomingUE]       UE(R08);                        // Вх. остаток, USD
    [ToIssue]          UE(R09);                        // К выдаче
    [PrepaymentRB]     RB(R10);                        // Аванс, BYN
    [PrepaymentEx]     Rate(R10);                      // Аванс, курс
    [PrepaymentUE]     UE(R10);                        // Аванс, USD
    [PaymBetwinRB]     RB(R11);                        // Отпуск, BYN
    [PaymBetwinEx]     if(RB(R11) = 0, 0, Rate(R11));  // Отпуск, курс
    [PaymBetwinUE]     UE(R11);                        // Отпуск, USD
    [SecPartRB]        RB(R13);                        // Выплата, BYN
    [SecPartEx]        if(RB(R13) = 0, 0, Rate(R13));  // Выплата, курс
    [SecPartUE]        UE(R13);                        // Выплата, USD
    [ThrdPartRB]       RB(R14);                        // Выплата 2-й части, BYN
    [ThrdPartEx]       if(RB(R14) = 0, 0, Rate(R14));  // Выплата 2-й части, курс
    [ThrdPartUE]       UE(R14);                        // Выплата 2-й части, USD
    [TotalIssuedRB]    RB(R16);                        // Итого выдано, BYN
    [TotalIssuedUE]    UE(R16);                        // Итого выдано, USD
    [OutgoingRB]       RB(R15);                        // Исх. остаток, BYN: mtDebtOut.NetBYN
    [OutgoingUE]       UE(R09) - UE(R16);              // Исх. остаток, USD: UE(R07) + UE(R08) + UE(R21) - (UE(R10) + UE(R11) + UE(R13) + UE(R14))
    [OutgoingUE_Check] UE(R15);                        // Исх. остаток - контроль с распечаткой, USD: mtDebtOut.NetUSD
    [OutgoingUE_Delta] UE(R09) - UE(R16) - UE(R15);
  );
)
end;

private procedure ReportBySotr;
{
  if (mtStruct.Mode <> 2)
  {
    message('Не выбран сотрудник.');
    exit;
  }

  CurPerson := mtStruct.Person;
  PushPos(#mtPeriods);
  ResetBounds(#mtStruct);
  PushBounds(tbCurSotr);
  RunFReport(dsReportBySotr, '', false);
  PopBounds(tbCurSotr);
  SetBounds(#mtStruct);
  PopPos(#mtPeriods);
}
