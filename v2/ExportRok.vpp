//------------------------------------------------------------------------------
//                                                      (c) Корпорация Галактика
// Заработная плата по отделу
// Экспорт в rok
//------------------------------------------------------------------------------

File fRok;

private procedure DoExportRok;
{
  fRok.OpenFile(sResFile, stCreate);
//  fRok.WriteLn('<rok:Wage xmlns:rok="http://178.172.132.68/pir/">');
//  fRok.WriteLine('<rok:Periods>');

  mtPeriods.SetStream(fRok.Handle);
  mtDepart.SetStream(fRok.Handle);
  mtDepHist.SetStream(fRok.Handle);
  mtPost.SetStream(fRok.Handle);
  mtPerson.SetStream(fRok.Handle);
  mtAppoint.SetStream(fRok.Handle);
  mtPersPer.SetStream(fRok.Handle);
  mtDebtIn.SetStream(fRok.Handle);
  mtNachisl.SetStream(fRok.Handle);
  mtPayment.SetStream(fRok.Handle);
  mtDebtOut.SetStream(fRok.Handle);


  fRok.WriteLine('<Pr>');
  _loop backward mtPeriods
    mtPeriods.Save;
  fRok.WriteLn('</Pr>');

  fRok.WriteLine('<Dp>');
  ResetBounds(#mtDepart);
  _loop mtDepart
    mtDepart.Save;
  SetBounds(#mtDepart);
  fRok.WriteLn('</Dp>');

  fRok.WriteLine('<Dh>');
  _loop mtDepHist
    mtDepHist.Save;
  fRok.WriteLn('</Dh>');

  fRok.WriteLine('<Pt>');
  ResetBounds(#mtPost);
  _loop mtPost
    mtPost.Save;
  SetBounds(#mtPost);
  fRok.WriteLn('</Pt>');

  fRok.WriteLine('<Ps>');
  _loop mtPerson
  {
    mtPerson.Save;

    fRok.WriteLn('<Ap>');
    _loop mtAppoint where (( mtPerson.Id == mtAppoint.Person ))
      mtAppoint.Save;
    fRok.WriteLn('</Ap>');

    fRok.WriteLn('<PP>');
    _loop mtPersPer where (( mtPerson.Id == mtPersPer.Person ))
    {
      mtPersPer.Save;

      fRok.WriteLn('<DI>');
      if (GetFirst mtDebtIn where (( mtPersPer.Person == mtDebtIn.Person and
                                     mtPersPer.Period == mtDebtIn.Period )) = tsOk)
        mtDebtIn.Save;
      fRok.WriteLn('</DI>');

      fRok.WriteLn('<Na>');
      _loop mtNachisl where (( mtPersPer.Person == mtNachisl.Person and
                               mtPersPer.Period == mtNachisl.Period ))
        mtNachisl.Save;
      fRok.WriteLn('</Na>');

      fRok.WriteLine('<Pm>');
      _loop mtPayment where (( mtPersPer.Person == mtPayment.Person and
                               mtPersPer.Period == mtPayment.Period ))
        mtPayment.Save;
      fRok.WriteLn('</Pm>');

      fRok.WriteLine('<DO>');
      if (GetFirst mtDebtOut where (( mtPersPer.Person == mtDebtOut.Person and
                                      mtPersPer.Period == mtDebtOut.Period )) = tsOk)
        mtDebtOut.Save;
      fRok.WriteLn('</DO>');
    }
    fRok.WriteLn('</PP>');
  }
  fRok.WriteLn('</Ps>');

  fRok.Close;
  StopVisual;
}
